<!DOCTYPE html>
<html>
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>Dust's Blog</title>
        <meta charset="utf-8" />
        <link href="/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="Dust's Blog Atom Feed" />

        <link href="https://cdn.bootcss.com/muicss/0.9.39/css/mui.min.css" rel="stylesheet">
        <link href="/theme/css/main.css" rel="stylesheet">
        <link href="/theme/css/highlight.css" rel="stylesheet">


    <meta name="tags" content="python" />
    <meta name="tags" content="scrapy" />

</head>

<body id="index" class="home">
  <div id="container" class="mui-container">
        <header id="banner" class="body">
                <h1><a href="/">Dust's Blog <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
            <li>
              <div class="index-cat"><a href="/">Index</a></div>
            </li>
              <li class="active">
                <div  class="last-cat" >
                  <a href="/category/tech.html">Tech</a>
                </div>
              </li>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="/scrapy-start-requests-trap.html" rel="bookmark">Scrapy æš—å‘ä¹‹ start_requests</a></h2>
 
  </header>
<footer class="post-info">
    <div class="category-info">
        ğŸ“ <a href="/category/tech.html">Tech</a>
    </div>
    <p class="tag-info">
 ğŸ“Œ             <a href="/tag/python.html">python</a>,            <a href="/tag/scrapy.html">scrapy</a>    </p>
    <time class="published" datetime="2018-03-01T14:03:42+08:00">
      ğŸ–Šï¸ 2018-03-01 14:03:42
    </time>
  </footer><!-- /.post-info -->  <div class="entry-content">
    <p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒScrapy é»˜è®¤ä¼šè¿‡æ»¤é‡å¤çš„ URLï¼Œä¸ä¼šé‡å¤æŠ“å–ç›¸åŒçš„ URLï¼Œé™¤éæ˜¾å¼æŒ‡å®šã€‚</p>
<p>äºæ˜¯éšä¾¿å†™äº†ä¸€ä¸ªçˆ¬å›¾ç‰‡åœ°å€çš„å°è™«ï¼Œç„¶è€Œä¸çŸ¥é“ä¸ºä»€ä¹ˆæ€»ä¼šçˆ¬ä¸¤æ¬¡ baidu é¦–é¡µï¼Œä½ èƒ½çœ‹å‡ºé”™åœ¨å“ªé‡Œå—ï¼Ÿ</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ImageSpider</span><span class="p">(</span><span class="n">scrapy</span><span class="o">.</span><span class="n">Spider</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;images&quot;</span>
    <span class="n">allowed_domains</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;www.baidu.com&quot;</span><span class="p">]</span>
    <span class="n">start_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;https://www.baidu.com/&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="n">images</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//img/@src&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
            <span class="n">image_item</span> <span class="o">=</span> <span class="n">ImageItem</span><span class="p">()</span>
            <span class="n">image_item</span><span class="p">[</span><span class="s1">&#39;img_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">urljoin</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">yield</span> <span class="n">image_item</span>

        <span class="n">urls</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//a/@href&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
            <span class="n">next_url</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">urljoin</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">yield</span> <span class="n">Request</span><span class="p">(</span><span class="n">next_url</span><span class="p">)</span>
</pre></div>


<p>æˆ‘æƒ³äº†åŠå¤©éƒ½ä¸æ˜ç™½ä¸ºä»€ä¹ˆï¼Œä»¥ä¸ºæ˜¯è¿‡æ»¤å™¨çš„é—®é¢˜ï¼ŒæŸ¥äº†åŠå¤©èµ„æ–™ä»æ²¡è§£å†³ã€‚ åæ¥å¶ç„¶çœ‹äº† Spider æºç ï¼Œæ‰å‘ç°å‘çˆ¹ä¹‹å¤„ã€‚</p>
<p>åŸæ¥æºç çš„ start_requests æ˜¯è¿™æ ·å†™çš„ï¼ˆå·²å¿½ç•¥æ— å…³ä»£ç ï¼‰</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">start_requests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_urls</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">dont_filter</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå› æ˜¾å¼æŒ‡å®šäº† dont_filter=Trueï¼Œstart_urls ä¸­çš„ URL åœ¨é¦–æ¬¡è¯·æ±‚æ—¶ä¸ä¼šåŠ å…¥è¿‡æ»¤åˆ—è¡¨ä¸­ï¼Œè¿™æ ·ç›¸åŒçš„ URL ç¬¬äºŒæ¬¡è¯·æ±‚æ—¶ç”±äºä¸å­˜åœ¨äºè¿‡æ»¤åˆ—è¡¨ä¸­ï¼Œå¯¼è‡´äº†äºŒæ¬¡æŠ“å–ã€‚</p>
<p>æˆ‘å®åœ¨ä¸æ˜ç™½ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ç§çŸ›ç›¾ï¼Œæ—¢ç„¶é»˜è®¤è¿‡æ»¤é‡å¤ URLï¼Œé‚£ä¹ˆåœ¨æºç å„ä¸ªåœ°æ–¹éƒ½åº”è´¯å½»è¿™ä¸ªåŸåˆ™ã€‚</p>
<p>å¦‚æœåªæ˜¯è¿™æ ·å°±ç®—äº†ï¼Œç„¶è€Œåœ¨å®˜æ–¹æ•™ç¨‹ä¸­ä¹ŸåŸ‹äº†è¿™æ ·çš„å‘ï¼š <a href="https://doc.scrapy.org/en/latest/intro/tutorial.html">Scrapy Tutorial</a>  (<a href="https://github.com/scrapy/scrapy/blob/9dd680d5c94340ac308f1450d9d3dc226a015326/docs/intro/tutorial.rst">å¤‡ä»½</a>)</p>
<p>åœ¨ Our first Spider è¿™ä¸€èŠ‚ä¸­ï¼Œæ˜¯è¿™æ ·å†™ start_requests çš„</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">start_requests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;http://quotes.toscrape.com/page/1/&#39;</span><span class="p">,</span>
        <span class="s1">&#39;http://quotes.toscrape.com/page/2/&#39;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">)</span>
</pre></div>


<p>ç„¶ååœ¨ A shortcut to the start_requests method ä¸€èŠ‚ä¸­è¡¨ç¤º</p>
<blockquote>
<p>Instead of implementing a <code>start_requests()</code> method that generates <code>scrapy.Request</code> objects from URLs, you can just define a <code>start_urls</code> class attribute with a list of URLs. This list will then be used by the default implementation of <code>start_requests()</code> to create the initial requests for your spider</p>
</blockquote>
<p>å¯ä»¥æŠŠ urls æå–åˆ° start_urls ç„¶åç›´æ¥ use the default implementation of start_requests()ã€‚è®©äººè¯¯ä»¥ä¸º start_requests é»˜è®¤å®ç°ä¹Ÿæ²¡æœ‰è®¾ç½® dont_filter=Trueã€‚ç®€ç›´å°±æ˜¯æŠŠå…¨ä¸–ç•Œæ‰€æœ‰æ–°æ‰‹éƒ½å‘äº†ä¸€éâ€¦â€¦</p>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body mui--divider-top">
                <address id="about" class="vcard body">
                Powered by <a href="https://github.com/getpelican/pelican">Pelican</a>.
                Theme <a href="/">Autism</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
  </div>

  <script defer src="/theme/js/image.js"></script>
</body>
</html>